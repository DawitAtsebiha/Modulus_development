<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modulus | Dashboard</title>

    <!-- Re‑use the same fonts / icons as the auth pages -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Quick in‑file styles so the page works out‑of‑the‑box.
         Replace with your proper CSS pipeline when you wire this into Vite / Tailwind / etc. -->
    <style>
      :root {
        --accent: #2563eb; /* Tailwind blue‑600 */
      }
      * { box-sizing: border-box; font-family: Inter, sans-serif; }
      body {
        margin: 0;
        min-height: 100vh;
        background: #f9fafb;
        display: flex;
        flex-direction: column;
      }
      header {
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        padding: 0.75rem 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      header img { height: 32px; }
      main {
        width: 100%;
        max-width: 960px;
        margin: 2.5rem auto 4rem;
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 2rem 2.5rem;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      }
      h1 {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 1.5rem;
      }
      dl {
        margin: 0;
        display: grid;
        grid-template-columns: 160px 1fr;
        row-gap: 0.75rem;
      }
      dt { color: #6b7280; }
      dd { margin: 0; font-weight: 500; }
      #loading {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        color: #6b7280;
      }
      #loading i { animation: spin 1.1s linear infinite; }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      #error { color: #dc2626; }
    </style>
  </head>
  <body>
    <!-- Simple top bar / brand.  Swap the logo src when you have an asset ready -->
    <header>
      <div class="brand">
        <img src="/themodulus.ca/visuals/SVGs/mod-logo.svg" alt="Modulus" />
      </div>
      <nav>
        <a href="#" id="logout" style="color:#ef4444;text-decoration:none;font-weight:500;">Log out</a>
      </nav>
    </header>

    <main>
      <h1>Your profile</h1>

      <div id="loading"><i class="fa fa-spinner"></i> Loading…</div>
      <p id="error" style="display:none"></p>

      <dl id="profile" style="display:none"></dl>
    </main>

    <script>
      (function () {
        const API_ENDPOINT = '/api/me'; // adjust if you mount your API elsewhere

        const FIELD_LABELS = {
          uuid: 'User ID',
          firstName: 'First name',
          lastName: 'Last name',
          email: 'Email',
          dateOfBirth: 'Date of birth',
          creationDate: 'Joined',
          schoolStatus: 'School status',
          uniAffiliation: 'University / College'
        };

        const loadingEl  = document.getElementById('loading');
        const profileEl  = document.getElementById('profile');
        const errorEl    = document.getElementById('error');

        /**
         * Renders key/value pairs as <dt>/<dd> rows.
         */
        function renderProfile(data) {
          profileEl.innerHTML = '';
          Object.entries(FIELD_LABELS).forEach(([key, label]) => {
            if (data[key] === undefined) return; // skip if not present
            const dt = document.createElement('dt');
            dt.textContent = label;
            const dd = document.createElement('dd');
            dd.textContent = data[key] || '—';
            profileEl.appendChild(dt);
            profileEl.appendChild(dd);
          });
        }

        /**
         * Fetch current‑user profile from backend.
         * Assumes session cookie / JWT auth is already set up.
         */
        async function loadProfile() {
          loadingEl.style.display = 'flex';
          errorEl.style.display   = 'none';
          profileEl.style.display = 'none';

          try {
            const res = await fetch(API_ENDPOINT, { credentials: 'include' });
            if (!res.ok) throw new Error('HTTP ' + res.status);
            const json = await res.json();
            renderProfile(json);
            profileEl.style.display = 'grid';
          } catch (err) {
            errorEl.textContent   = 'Unable to load profile: ' + err.message;
            errorEl.style.display = 'block';
          } finally {
            loadingEl.style.display = 'none';
          }
        }

        document.getElementById('logout').addEventListener('click', async e => {
          e.preventDefault();
          await fetch('/api/logout', { method: 'POST', credentials: 'include' }).catch(() => {});
          window.location.href = '/';
        });

        loadProfile();
      });
    </script>
    <script type="module" src="/themodulus.ca/src/JS/login_page.js"></script>
  </body>
</html>
